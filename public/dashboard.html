<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="css/dash.css">
    <link rel="icon" href="img/GPA2.png" type="image/x-icon">
</head>
<body>
    <h1>Dashboard de Cadastros</h1>
    <a href="index.html"><button>Voltar</button></a>
    <button onclick="carregarDados()">Atualizar Dados</button>
    
    <div id="filtros">
        <input type="text" id="filtroMatricula" placeholder="Filtrar por Matrícula">
        <input type="text" id="filtroColetor" placeholder="Filtrar por Coletor">
        <input type="text" id="filtroTurno" placeholder="Filtrar por Turno">
        <input type="text" id="filtroData" placeholder="Filtrar por Data">
        <button onclick="filtrarDados()">Filtrar</button>
    </div>
    
    <table>
        <thead>
            <tr>
                <th>Matrícula</th>
                <th>Coletor</th>
                <th>Turno</th>
                <th>Data</th>
            </tr>
        </thead>
        <tbody id="dataTable"></tbody>
    </table>

    <script>
        let dados = [];

        async function carregarDados() {
            try {
                const response = await fetch('/api/coletores');
                const data = await response.json();
                console.log('Dados recebidos:', data); // Verificando os dados
                dados = data;
                exibirDados(dados);
            } catch (error) {
                console.error('Erro ao carregar os dados:', error);
            }
        }

        function exibirDados(dados) {
            const dataTable = document.getElementById('dataTable');
            dataTable.innerHTML = dados.map(item => {
                const dataFormatada = item.data
                    ? new Date(item.data).toLocaleDateString('pt-BR', { timeZone: 'UTC' })
                    : 'Não Disponível';
                return `
                    <tr>
                        <td>${item.matricula}</td>
                        <td>${item.coletor}</td>
                        <td>${item.turno}</td>
                        <td>${dataFormatada}</td>
                    </tr>
                `;
            }).join('');
        }

        function filtrarDados() {
            const matricula = document.getElementById('filtroMatricula').value.toLowerCase();
            const coletor = document.getElementById('filtroColetor').value.toLowerCase();
            const turno = document.getElementById('filtroTurno').value.toLowerCase();
            const data = document.getElementById('filtroData').value.toLowerCase();

            const dadosFiltrados = dados.filter(item =>
                (!matricula || item.matricula.toLowerCase().includes(matricula)) &&
                (!coletor || item.coletor.toLowerCase().includes(coletor)) &&
                (!turno || item.turno.toLowerCase().includes(turno)) &&
                (!data || new Date(item.data).toLocaleDateString('pt-BR', { timeZone: 'UTC' }).includes(data))
            );
            exibirDados(dadosFiltrados);
        }

        carregarDados();
    </script>
</body>
</html>
